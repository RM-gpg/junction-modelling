<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Search Algorithm Simulation Runs</title>
    <style>
        /* Load SF Pro font (same as leaderboards.html) */
        @font-face {
            font-family: 'SF Pro';
            src: url("{{ url_for('static', filename='fonts/SF-Pro.ttf') }}") format('truetype');
            font-style: normal;
            font-weight: 400;
        }
        /* Reset & Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        body {
            background-color: #a2bf89; /* Match the green background */
            font-family: 'SF Pro', sans-serif;
            color: #6b6b6b;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 5vh 0;
        }
        /* Header */
        .header {
            width: 90%;
            text-align: center;
            margin-bottom: 4vh;
        }
        .header h1 {
            font-size: 3vw;
            color: #f8f5e9;
            font-weight: 600;
        }
        /* Search Container */
        .search-container {
            background-color: #f8f5e9;
            border-radius: 1.2vw;
            padding: 2vh 3vh;
            width: 90%;
            max-width: 600px;
            text-align: center;
            box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.1);
        }
        .search-container form {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .search-container label {
            font-size: 1.2vw;
            margin: 1vh 0 0.5vh 0;
            color: #6b6b6b;
        }
        .search-container input {
            width: 80%;
            padding: 1vh;
            margin-bottom: 2vh;
            border: 1px solid #ccc;
            border-radius: 0.5vw;
            font-size: 1.2vw;
        }
        .search-container button {
            background-color: #8da676;
            color: #f8f5e9;
            padding: 1.2vh 2.5vw;
            border: none;
            border-radius: 2vw;
            font-size: 1.2vw;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .search-container button:hover {
            background-color: #789563;
        }
        .download-container {
            text-align: center;
            margin-top: 20px;
            width: 90%;
            max-width: 1400px;
            display: flex;
            justify-content: center; 
            align-items: center;   
            font-size: 2vh; 
        }
        .download-container a {
            text-decoration: none;
            color: #f8f5e9;
            background-color: #8da676;
            padding: 1.2vh 2.5vw;
            border-radius: 2vw;
            font-size: 0.5vw;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        .download-container a:hover {
            background-color: #789563;
        }
        /* Navigation Container */
        .nav-container {
            width: 90%;
            max-width: 1400px;
            margin-top: 3vh;
            display: flex;
            justify-content: space-between;
        }
        .nav-container a {
            text-decoration: none;
            color: #f8f5e9;
            background-color: #8da676;
            padding: 1.2vh 2.5vw;
            border-radius: 2vw;
            font-size: 1.2vw;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        .nav-container a:hover {
            background-color: #789563;
        }
        /* Responsive Design */
        @media (max-width: 600px) {
            .header h1 {
                font-size: 6vw;
            }
            .search-container label, 
            .search-container input, 
            .search-container button {
                font-size: 4vw;
            }
            .nav-container a {
                font-size: 3vw;
                padding: 2vh 4vw;
            }
        }
        /* Tutorial Popup and Button styles */
        #tutorial-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: green;
            color: white;
            text-align: center;
            line-height: 50px;
            font-size: 24px;
            cursor: pointer;
            z-index: 1000;
        }
        
        #tutorial-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 45%;
            height: 45%;
            background-color: #fff;
            border: 2px solid #ccc;
            border-radius: 10px;
            padding: 20px;
            z-index: 1001;
            overflow-y: auto;
        }
        
        #tutorial-popup-content {
            position: relative;
            width: 100%;
            height: 100%;
        }
        
        #tutorial-close {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- Header with search emojis on either side -->
    <div class="header">
        <h1>üîç Search Algorithm Simulation Runs üîç</h1>
    </div>

    <!-- Search Form Container -->
    <div class="search-container">
        <form id="searchForm" action="/junction_details" method="get">
            <label for="run_id">Run ID:</label>
            <input type="text" id="run_id" name="run_id" placeholder="Enter Run ID" required>
            
            <label for="session_id">Session ID:</label>
            <input type="text" id="session_id" name="session_id" placeholder="Enter Session ID" required>
            
            <button type="submit">Search</button>
        </form>
    </div>

    <div class="nav-container">
        <a class="nav-button" id="endBtn" href="/index">‚ùå End Session</a>
        <a class="res-button" id="results" href="/back_to_results">üéâ Back to Results</a>
        <a href="{{ url_for('download_metrics_json') }}">‚è¨ Download all Run IDs ‚è¨</a>
        <a class="nav-button" id="backBtn" href="/parameters">‚úÖ Continue Session (Back to Inputs)</a>
    </div>
    <script>
        function handleRowClick(runId) {
            // Only redirect if we got a valid runId
            if (runId) {
                window.location.href = "/junction_details?run_id=" + runId;
            }
        }

        document.getElementById("backBtn").addEventListener("click", async () => {
            console.log("Back button clicked. Stopping FastAPI...");

            try {
                let stopResponse = await fetch('/stop_simulation', { method: 'POST' });
                let stopData = await stopResponse.json();
                
                if (stopResponse.ok) {
                    console.log("‚úÖ FastAPI stopped:", stopData.message);
                    // Redirect back to the parameters page
                    window.location.href = "/parameters";
                } else {
                    console.error("‚ùå Error stopping FastAPI:", stopData.error);
                }
            } catch (error) {
                console.error("‚ùå Error sending stop request:", error);
            }
        });

        document.getElementById("endBtn").addEventListener("click", async () => {
            console.log("Back button clicked. Stopping FastAPI...");

            try {
                let stopResponse = await fetch('/stop_simulation', { method: 'POST' });
                let stopData = await stopResponse.json();
                
                if (stopResponse.ok) {
                    console.log("‚úÖ FastAPI stopped:", stopData.message);
                    // Redirect back to the index page
                    window.location.href = "/index";
                } else {
                    console.error("‚ùå Error stopping FastAPI:", stopData.error);
                }
            } catch (error) {
                console.error("‚ùå Error sending stop request:", error);
            }
        });
    </script>
    
    <!-- Tutorial Popup and Button -->
    <div id="tutorial-popup">
        <div id="tutorial-popup-content">
            <span id="tutorial-close">&times;</span>
            <h2>Search Algorithm Runs</h2>
            <br>
            <p>Using the session ID and run ID, search up a run and all its details and results will be displayed.</p>
            <br>
            <p>'Download Run ID' lets you download the session ID, run ID, overall scores and score differences of all past runs. So if you remember achieving a certain score but can't remember what your parameter inputs were, you can find the session ID and run ID from the downloaded file. Then you can search up that old run!</p>
        </div>
    </div>
    <div id="tutorial-button">?</div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const tutorialButton = document.getElementById('tutorial-button');
            const tutorialPopup = document.getElementById('tutorial-popup');
            const tutorialClose = document.getElementById('tutorial-close');
            
            tutorialButton.addEventListener('click', function() {
                tutorialPopup.style.display = 'block';
            });
            
            tutorialClose.addEventListener('click', function() {
                tutorialPopup.style.display = 'none';
            });
            
            // Close the popup when clicking outside of the content area
            tutorialPopup.addEventListener('click', function(e) {
                if(e.target === tutorialPopup) {
                    tutorialPopup.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>
