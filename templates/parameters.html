<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Junction Simulation</title>
  <style>
    /* Load SF Pro font at normal weight */
    @font-face {
      font-family: 'SF Pro';
      src: url("{{ url_for('static', filename='fonts/SF-Pro.ttf') }}") format('truetype');
      font-style: normal;
      font-weight: 400;
    }

    /* Reset & base styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html,
    body {
      width: 100%;
      height: 100%;
      overflow: hidden; /* Prevent scrolling */
    }

    body {
      background-color: #a2bf89; /* Green background */
      font-family: 'SF Pro', sans-serif;
      font-weight: 400; /* Normal weight everywhere */
      color: #6b6b6b;
      display: flex;
      flex-direction: column;
    }

    /* Main container to manage vertical space */
    .main-container {
      flex: 1; /* Take remaining vertical space */
      display: flex;
      flex-direction: column;
    }

    /* Header: left-aligned heading with top margin */
    .header {
      margin: 4vh 5vw 0 5vw; /* 4vh top, 5vw sides, 0 bottom */
    }

    .header h1 {
      color: #f8f5e9;
      font-size: 3vw;
      text-align: left; /* left-aligned */
    }

    /* Content area for top row + bottom box */
    .content {
      flex: 1; /* Fill remaining space */
      margin: 2vh 5vw 4vh 5vw; /* 2vh top, 5vw sides, 4vh bottom */
      display: flex;
      flex-direction: column;
      gap: 2vh; /* vertical gap between top row & bottom box */
    }

    /* Top row: two side-by-side boxes */
    .top-row {
      display: flex;
      gap: 2vw;
      flex: 1; /* let top row grow to fill vertical space */
    }

    /* Boxes (left & right, plus bottom) */
    .box,
    .bottom-box {
      background-color: #f8f5e9;
      border-radius: 1.2vw; /* more rounding */
      padding: 2vh;
      display: flex;
      flex-direction: column;
    }

    .box {
      flex: 1; /* each top box grows equally */
      min-height: 0; /* let flex container control the height */
    }

    /* Titles inside the boxes */
    .box h2 {
      color: #8da676;
      font-size: 1.6vw;
      margin-bottom: 2vh;
    }

    /* Dropdown headings */
    .dropdown-heading {
      cursor: pointer;
      font-weight: 400;
      font-size: 1.2vw;
      margin: 2vh 0 1vh;
      display: flex;
      align-items: center;
    }

    .dropdown-heading span.symbol {
      margin-right: 8px;
      color: #8da676;
      font-size: 1.6vw;
      font-weight: bold;
    }

    /* Drop-down content hidden by default */
    .dropdown-content {
      display: none;
      margin-left: 1vw;
      margin-bottom: 2vh;
    }

    .dropdown-content ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .dropdown-content li {
      display: flex;
      align-items: center;
      margin: 1vh 0;
    }

    .dropdown-content li label {
      flex: 0 0 8vw;
      margin-right: 1vw;
      font-size: 1vw;
    }

    .dropdown-content li input[type="text"] {
      flex: 1;
      padding: 0.5vh 1vw;
      font-size: 1vw;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    /* Slider container (Number of lanes) */
    .slider-container {
      margin: 2vh 0;
    }

    .slider-container label {
      display: block;
      margin-bottom: 1vh;
      font-weight: 400;
      font-size: 1vw;
    }

    .slider-container input[type="range"] {
      width: 60%;
    }

    /* Numbers below the slider */
    .slider-values {
      display: flex;
      justify-content: space-between;
      width: 60%;
      margin-top: 1vh;
    }

    .slider-values span {
      font-size: 1vw;
    }

    /* Checkbox container */
    .checkbox-container {
      display: flex;
      align-items: center;
      margin-bottom: 2vh;
    }

    .checkbox-container label {
      margin-left: 1vw;
      font-size: 1vw;
    }

    /* Bottom box (spans full width) */
    .bottom-box {
      flex: 0.4; /* ~40% of the remaining content height */
      align-items: center;
      justify-content: center;
      text-align: center;
    }

    /* Drag-and-drop area inside the bottom box */
    .drag-drop-box {
      border: 2px dashed #8da676;
      border-radius: 1vw;
      padding: 3vh 2vw;
      color: #6b6b6b;
      cursor: pointer;
      max-width: 600px;
      margin: 0 auto;
    }

    .drag-drop-box p {
      font-size: 1.2vw;
      margin: 1vh 0;
    }

    /* Hide the file input (custom UI) */
    #file-input {
      display: none;
    }

    /* Upload button style */
    .upload-button {
      margin-top: 3vh;
      width: 30vw;
      padding: 1vh 2vw;
      background-color: #f8f5e9;
      color: #a2bf89;
      border: none;
      border-radius: 2vw;
      cursor: pointer;
      font-size: 1.5vw;
      border-radius: 6vw;
      margin: 3vh auto 0; /* Centering the button */
      display: block; /* Ensure proper centering */
      font-weight: bold;
    }

    .upload-button:hover {
      background-color: #789563;
    }

    /* Responsive text sizing fallback for smaller screens */
    @media (max-width: 600px) {
      .header h1 {
        font-size: 6vw;
      }
      .dropdown-heading span.symbol {
        font-size: 4vw;
      }
      .dropdown-heading {
        font-size: 3vw;
      }
      .dropdown-content li label {
        flex: 0 0 30vw;
      }
      .dropdown-content li input[type="text"] {
        font-size: 3vw;
      }
      .slider-container label,
      .slider-values span,
      .checkbox-container label {
        font-size: 3vw;
      }
      .drag-drop-box p {
        font-size: 3vw;
      }
    }
  </style>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Toggle logic for each drop-down (only one open at a time)
      const dropdowns = document.querySelectorAll('.dropdown-heading');
      dropdowns.forEach(heading => {
        heading.addEventListener('click', () => {
          const content = heading.nextElementSibling;
          // Close all other dropdowns
          dropdowns.forEach(other => {
            if (other !== heading) {
              const otherContent = other.nextElementSibling;
              otherContent.style.display = 'none';
              other.querySelector('.symbol').textContent = '—';
            }
          });
          // Toggle current dropdown
          if (content.style.display === 'block') {
            content.style.display = 'none';
            heading.querySelector('.symbol').textContent = '—';
          } else {
            content.style.display = 'block';
            heading.querySelector('.symbol').textContent = '|';
          }
        });
      });

      // Drag & Drop functionality for file upload area
      const dropZone = document.querySelector('.drag-drop-box');
      const fileInput = document.getElementById('file-input');
      dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.style.backgroundColor = '#ececec';
      });
      dropZone.addEventListener('dragleave', () => {
        dropZone.style.backgroundColor = '#f8f5e9';
      });
      dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.style.backgroundColor = '#f8f5e9';
        if (e.dataTransfer.files.length) {
          fileInput.files = e.dataTransfer.files;
        }
      });
      dropZone.addEventListener('click', () => {
        fileInput.click();
      });

      // When the Start button is clicked, copy the parameter values into the hidden form and submit it.
      document.getElementById("startButton").addEventListener("click", function() {
        // North
        document.getElementById("hidden_nb_forward").value = document.getElementById("nb_forward").value;
        document.getElementById("hidden_nb_left").value = document.getElementById("nb_left").value;
        document.getElementById("hidden_nb_right").value = document.getElementById("nb_right").value;
        // East
        document.getElementById("hidden_eb_forward").value = document.getElementById("eb_forward").value;
        document.getElementById("hidden_eb_left").value = document.getElementById("eb_left").value;
        document.getElementById("hidden_eb_right").value = document.getElementById("eb_right").value;
        // South
        document.getElementById("hidden_sb_forward").value = document.getElementById("sb_forward").value;
        document.getElementById("hidden_sb_left").value = document.getElementById("sb_left").value;
        document.getElementById("hidden_sb_right").value = document.getElementById("sb_right").value;
        // West
        document.getElementById("hidden_wb_forward").value = document.getElementById("wb_forward").value;
        document.getElementById("hidden_wb_left").value = document.getElementById("wb_left").value;
        document.getElementById("hidden_wb_right").value = document.getElementById("wb_right").value;
        // Junction Settings
        document.getElementById("hidden_lanes").value = document.getElementById("lanes").value;
        document.getElementById("hidden_left-turn").value = document.getElementById("left-turn").checked ? "on" : "";
        document.getElementById("hidden_pedestrian_events").value = document.getElementById("pedestrian-events").value;
        
        // Submit the hidden form.
        document.getElementById("hiddenForm").submit();
      });
    });
  </script>
  <!-- In parameters.html, inside a <script> tag or in an external JS file -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const lanesSlider = document.getElementById("lanes");
      lanesSlider.addEventListener("input", function() {
        localStorage.setItem("numOfLanes", this.value);
      });
    });
  </script>
</head>
<body>
  <div class="main-container">
    <!-- Header -->
    <div class="header">
      <h1>Input your parameters</h1>
    </div>

    <!-- Content -->
    <div class="content">
      <!-- Top row: Visible parameters form -->
      <form id="parameterForm">
        <div class="top-row">
          <!-- Left box -->
          <div class="box">
            <h2>Configurable Parameters</h2>
            <!-- North -->
            <div class="dropdown-heading">
              <span class="symbol">—</span> North
            </div>
            <div class="dropdown-content">
              <ul>
                <li>
                  <label for="nb_forward">Forward</label>
                  <input type="text" id="nb_forward" name="nb_forward">
                </li>
                <li>
                  <label for="nb_left">Turning Left</label>
                  <input type="text" id="nb_left" name="nb_left">
                </li>
                <li>
                  <label for="nb_right">Turning Right</label>
                  <input type="text" id="nb_right" name="nb_right">
                </li>
              </ul>
            </div>
            <!-- East -->
            <div class="dropdown-heading">
              <span class="symbol">—</span> East
            </div>
            <div class="dropdown-content">
              <ul>
                <li>
                  <label for="eb_forward">Forward</label>
                  <input type="text" id="eb_forward" name="eb_forward">
                </li>
                <li>
                  <label for="eb_left">Turning Left</label>
                  <input type="text" id="eb_left" name="eb_left">
                </li>
                <li>
                  <label for="eb_right">Turning Right</label>
                  <input type="text" id="eb_right" name="eb_right">
                </li>
              </ul>
            </div>
            <!-- South -->
            <div class="dropdown-heading">
              <span class="symbol">—</span> South
            </div>
            <div class="dropdown-content">
              <ul>
                <li>
                  <label for="sb_forward">Forward</label>
                  <input type="text" id="sb_forward" name="sb_forward">
                </li>
                <li>
                  <label for="sb_left">Turning Left</label>
                  <input type="text" id="sb_left" name="sb_left">
                </li>
                <li>
                  <label for="sb_right">Turning Right</label>
                  <input type="text" id="sb_right" name="sb_right">
                </li>
              </ul>
            </div>
            <!-- West -->
            <div class="dropdown-heading">
              <span class="symbol">—</span> West
            </div>
            <div class="dropdown-content">
              <ul>
                <li>
                  <label for="wb_forward">Forward</label>
                  <input type="text" id="wb_forward" name="wb_forward">
                </li>
                <li>
                  <label for="wb_left">Turning Left</label>
                  <input type="text" id="wb_left" name="wb_left">
                </li>
                <li>
                  <label for="wb_right">Turning Right</label>
                  <input type="text" id="wb_right" name="wb_right">
                </li>
              </ul>
            </div>
          </div>
          <!-- Right box -->
          <div class="box">
            <h2>Junction Settings</h2>
            <!-- Number of lanes slider -->
            <div class="slider-container">
              <label for="lanes">Number of lanes</label>
              <input type="range" id="lanes" name="lanes" min="1" max="5" value="2">
              <div class="slider-values">
                <span>1</span>
                <span>2</span>
                <span>3</span>
                <span>4</span>
                <span>5</span>
              </div>
            </div>
            <!-- Left-turn lane checkbox -->
            <div class="checkbox-container">
              <input type="checkbox" id="left-turn" name="left-turn" checked>
              <label for="left-turn">Left-turn lane</label>
            </div>
            <!-- Pedestrians -->
            <div style="display: flex; align-items: center; margin: 2vh 0 1vh;">
              <label for="pedestrian-events" style="font-size: 1.2vw; font-weight: 400; margin-right: 1vw; cursor: default;">
                Pedestrian events per hour
              </label>
              <input type="number" id="pedestrian-events" name="pedestrian-events" min="0" max="5" style="padding: 0.5vh 1vw; font-size: 1vw; border: 1px solid #ccc; border-radius: 4px;">
            </div>
          </div>
        </div>
      </form>

      <!-- Bottom box: File Upload area (remains in its own form) -->
      <form action="{{ url_for('upload') }}" method="POST" enctype="multipart/form-data" style="flex: 0;">
        <div class="bottom-box">
          <div class="drag-drop-box">
            <p style="font-size: 2vw;">+</p>
            <p>Drag and drop your file here</p>
            <p>Browse files from computer here</p>
          </div>
          <input type="file" name="file" id="file-input" />
          <br>
        </div>
      </form>

      <!-- Hidden Final Submission Form: Contains hidden copies of parameter values and the Start button -->
      <form id="hiddenForm" action="/parameters" method="POST" enctype="multipart/form-data">
        <!-- Hidden inputs for parameters -->
        <input type="hidden" id="hidden_nb_forward" name="nb_forward" value="">
        <input type="hidden" id="hidden_nb_left" name="nb_left" value="">
        <input type="hidden" id="hidden_nb_right" name="nb_right" value="">

        <input type="hidden" id="hidden_eb_forward" name="eb_forward" value="">
        <input type="hidden" id="hidden_eb_left" name="eb_left" value="">
        <input type="hidden" id="hidden_eb_right" name="eb_right" value="">

        <input type="hidden" id="hidden_sb_forward" name="sb_forward" value="">
        <input type="hidden" id="hidden_sb_left" name="sb_left" value="">
        <input type="hidden" id="hidden_sb_right" name="sb_right" value="">

        <input type="hidden" id="hidden_wb_forward" name="wb_forward" value="">
        <input type="hidden" id="hidden_wb_left" name="wb_left" value="">
        <input type="hidden" id="hidden_wb_right" name="wb_right" value="">

        <input type="hidden" id="hidden_lanes" name="lanes" value="">
        <input type="hidden" id="hidden_left-turn" name="left-turn" value="">
        <input type="hidden" id="hidden_pedestrian_events" name="pedestrian-events" value="">
        
        <!-- The visible Start button -->
        <button class="upload-button" type="button" id="startButton">Start</button>
      </form>

    </div>
  </div>
</body>
</html>
